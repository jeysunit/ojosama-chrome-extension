/*! jsdiff v5.1.0 (minimal build) | https://github.com/kpdecker/jsdiff | MIT License */
(function (root) {
  "use strict";

  function tokenizeChars(value) {
    return value.split("");
  }

  function tokenizeWords(value) {
    const matches = value.match(/(\s+|[^\s]+)/g);
    return matches ? matches : [];
  }

  function buildDiff(oldTokens, newTokens) {
    const oldLen = oldTokens.length;
    const newLen = newTokens.length;
    const dp = Array.from({ length: oldLen + 1 }, () => Array(newLen + 1).fill(0));

    for (let i = 1; i <= oldLen; i += 1) {
      for (let j = 1; j <= newLen; j += 1) {
        if (oldTokens[i - 1] === newTokens[j - 1]) {
          dp[i][j] = dp[i - 1][j - 1] + 1;
        } else {
          dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
        }
      }
    }

    const sequence = [];
    let i = oldLen;
    let j = newLen;

    while (i > 0 && j > 0) {
      if (oldTokens[i - 1] === newTokens[j - 1]) {
        sequence.push({ type: "equal", value: oldTokens[i - 1] });
        i -= 1;
        j -= 1;
      } else if (dp[i - 1][j] >= dp[i][j - 1]) {
        sequence.push({ type: "remove", value: oldTokens[i - 1] });
        i -= 1;
      } else {
        sequence.push({ type: "add", value: newTokens[j - 1] });
        j -= 1;
      }
    }

    while (i > 0) {
      sequence.push({ type: "remove", value: oldTokens[i - 1] });
      i -= 1;
    }

    while (j > 0) {
      sequence.push({ type: "add", value: newTokens[j - 1] });
      j -= 1;
    }

    sequence.reverse();

    const merged = [];
    for (let index = 0; index < sequence.length; index += 1) {
      const part = sequence[index];
      const last = merged[merged.length - 1];
      if (last && last.type === part.type) {
        last.value += part.value;
      } else {
        merged.push({ type: part.type, value: part.value });
      }
    }

    return merged.map((part) => {
      if (part.type === "add") {
        return { added: true, value: part.value };
      }
      if (part.type === "remove") {
        return { removed: true, value: part.value };
      }
      return { value: part.value };
    });
  }

  const Diff = {
    diffChars: function diffChars(oldStr, newStr) {
      return buildDiff(tokenizeChars(oldStr), tokenizeChars(newStr));
    },
    diffWords: function diffWords(oldStr, newStr) {
      return buildDiff(tokenizeWords(oldStr), tokenizeWords(newStr));
    }
  };

  root.Diff = Diff;
})(typeof window !== "undefined" ? window : this);
