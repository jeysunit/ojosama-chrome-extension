# ojosama-chrome-extension

## 概要

**ojosama-chrome-extension** は、Webページ上で選択したテキストを  
いわゆる「お嬢様言葉」に変換し、その結果を**新しいタブ**で表示する Chrome 拡張機能です。

変換結果は、**変換前 / 変換後を左右に並べた side-by-side UI** で表示され、  
どこがどのように変化したかを **差分ハイライト** によって視覚的に確認できます。

本プロジェクトは **Chrome 拡張（Manifest V3）** を前提としており、  
CSP（Content Security Policy）制約を考慮した実装・構成を採用しています。

---

## 主な機能

- **お嬢様変換**
  - 選択したテキストを独自ルールで「お嬢様言葉」に変換

- **新しいタブでの結果表示**
  - 変換結果は拡張専用の `result.html` を新規タブで表示

- **変換前後の左右比較表示**
  - 左側：元のテキスト
  - 右側：お嬢様変換後のテキスト

- **差分ハイライト表示**
  - jsdiff を利用し、追加・変更箇所をハイライト表示

---

## 実装上のポイント

### result.html / result.js / result.css の役割

- **result.html**
  - 変換結果表示用の HTML
  - side-by-side レイアウトの土台となる静的構造を定義

- **result.js**
  - 変換前後テキストの受け取り
  - jsdiff を使った差分計算
  - DOM への差分反映・ハイライト処理

- **result.css**
  - 左右比較（side-by-side）UI のレイアウト
  - 差分（追加・変更）の視覚的表現

### side-by-side UI と diff 表示の概要

- 画面を左右 2 カラムに分割
- 左：元テキスト、右：変換後テキスト
- jsdiff によって算出した差分を HTML として描画し、
  - 追加部分を強調表示
  - 変更箇所を一目で把握できるようにしている

---

## 技術的制約と設計判断

### Manifest V3 の Content Security Policy 制約

- Manifest V3 では以下が厳しく制限されている
  - 外部 CDN からの script 読み込み
  - `eval` や動的 script 注入
- そのため、**すべての JavaScript は拡張機能内に静的に同梱**する必要がある

### jsdiff をローカル同梱している理由

- jsdiff は差分表示に不可欠なライブラリ
- CDN 利用は CSP により不可
- 将来的な拡張・保守性も考慮し、
  - npm / CDN ではなく
  - **拡張機能内に直接配置する方針**を採用

### 外部スクリプトを使わない設計方針

- Manifest V3 に適合することを最優先
- オフライン環境でも動作可能
- 拡張機能としての安全性・再現性を重視

---

## ファイル構成

現在はシンプルな **フラット構成** を採用しています。

- `manifest.json`
  - Chrome 拡張の定義（Manifest V3）

- `background.js`
  - 拡張のバックグラウンド処理
  - 選択テキストの受け渡しなどを担当

- `content.js`
  - Webページ上でのテキスト選択検知

- `result.html`
  - 変換結果表示用ページ

- `result.js`
  - 差分計算・表示ロジック

- `result.css`
  - side-by-side UI / 差分ハイライト用スタイル

- `jsdiff.js`（または同等のファイル）
  - 差分表示用ライブラリ（ローカル同梱）

初期段階では構造を単純に保ち、  
今後の機能追加や整理が必要になった段階でディレクトリ分割を検討する想定です。
